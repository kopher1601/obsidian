CORS(Cross-Origin Resource Sharing, 교차 출처 리소스 공유)는 브라우저에서 실행되는 스크립트가 다른 출처의 리소스와 상호작용할 수 있게 해주는 프로토콜입니다. 예를 들어, UI 앱이 다른 도메인에서 실행 중인 API를 호출하려고 할 때, 기본적으로 CORS로 인해 차단됩니다. 이것은 대부분의 브라우저에서 구현된 W3C 사양입니다.

따라서 CORS는 보안 문제나 공격이 아니라, 다른 출처 간의 데이터 공유나 통신을 차단하기 위해 브라우저에서 제공하는 기본적인 보호 장치입니다.

`"other origin"`란 JavaScript가 실행되는 위치와 액세스하려는 URL이 다음 중 하나라도 다른 경우를 의미합니다:
- a diffrent scheme(HTTP 또는 HTTPS)
- a diffrent domain
- a diffrent port

기본적으로 브라우저는 사이트가 로드된 도메인 이외의 도메인에 대한 요청을 허용하지 않는다. 예를 들어 `example.com` 에서 사이트를 열었다면 브라우저는 이 사이트에서 `api.example.com` 에 요청하는 것을 호용하지 않는다.

간단히 말하면, 브라우저는 CORS 메커니즘으로 이 엄격한 정책을 완화하고 일부 조건에서 서로 다른 출처 간의 요청을 허용한다고 할 수 있다.

## CORS 작동방식
애플리케이션이 두 개의 서로 다른 도메인 간에 호출하는 것은 모두 금지된다. 그러나 물론 그러한 호출이 필요할 때가 있다. 이때 CORS 를 이용하면 애플리케이션이 요청을 허용할 도메인, 그리고 공유할수 있는 세부 정보를 지정할 수 있다. CORS 메커니즘은 HTTP 헤더를 기반으로 작동하며 가장 중요한 헤더는 아래와 같다
- `Access-Control-Allow-Origin` : 도메인 리소스에 접근할 수 있는 외부 도메인(원본)을 지정한다
- `Access-Control-Allow-Methods` : 다른 도메인에 대해 접근을 허용하지만 특정 HTTP 방식만 허용하고 싶을 때 일부 HTTP 방식을 지정할 수 있다. 예를 들어 example.com 이 일부 엔드포인트를 호출할 수 있게 하면서 HTTP GET 만 허용할 수 있다
- `Acess-Control-Allow-Headers` : 특정 요청에 이용할 수 있는 헤더에 제한을 추가한다

> [[Spring Security]] 는 기본적으로 이러한 헤더를 응답에 추가하지 않는다.
![[IMG_0915.jpg]]

![[IMG_0914.jpg]]
CORS는 제한을 가하기보다 교차 도메인 호출의 **엄격한 제약 조건을 완화하도록 도와주는 기능**이다. 그리고 제한이 적용돼도 일부 상황에서는 엔드포인트를 호출할 수 있다. 이 동작이 항상 수행되는 것은 아니다. 종종 브라우저는 요청을 허용해야 하는지 테스트하기 위해 먼저 HTTP OPTIONS 방식으로 호출하는 경우가 있다. 이 테스트 요청을 사전요청([[Preflight]]) 이라고 한다. 이 요청이 실패하면 브라우저는 원래 요청을 수락하지 않는다. 
사전 요청을 할지 결정하는 것은 브라우즈의 책임이고 개발자가 이 논리를 구현해야 하는 것은 아니다.

CORS 메커니즘은 결국 브라우저에 관한 것이며 엔드포인트를 보호하는 방법은 아니다. CORS 메커니즘이 유일하게 보장하는 것은 허용하는 출처 도메인만 브라우저의 특정 페이지에서 요청을 수행할 수 있다는 것이다.
![[IMG_0916.jpg]]