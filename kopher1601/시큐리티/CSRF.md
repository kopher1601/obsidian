![[Pasted image 20251107200125.png]]
일반적인 CSRF(Cross-Site Request Forgery 또는 XSRF) 공격은 사용자의 명시적인 동의 없이 웹 애플리케이션에서 사용자를 대신하여 작업을 수행합니다. 일반적으로 사용자의 신원을 직접 도용하지는 않지만, 사용자의 의지와 무관하게 특정 행동을 수행하도록 악용합니다.

CSRF(Cross-Site Request Forgery; 사이트간 요청 위조) 도 웹 애플리케이션에 흔한 취약성이다. CSRF 공격은 특정 서버에서 작업을 호출하는 URL 을 추출해 애플리케이션 외부에서 재사용할 수 있다고 가정한다(CSRF 공격은 사용자가 웹 애플리케이션에 로그인했다고 가정). 서버가 요청의 출처를 확인하지 않고 무턱대고 실행하면 다른 모든 곳에서 요청이 실행될 수 있다. 공격자는 CSRF 를 통해 동작을 숨겨서 사용자가 서버에서 원치 않는 동작을 실행하도록 할 수 있다. 일반적으로 경격자는 CSRF 를 이용해 시스템의 데이터를 변경하는 동작을 실행한다.

## CSRF 보호
CSRF 보호는 웹 애플리케이션에서 프런트엔드만 변경작업을 수행할 수 있게 보장한다.
CSRF 보호는 어떻게 작동할까? 한 가지 확실한 것은 데이터를 변경하는 작업을 수행하려면 먼저 사용자가 적어도 한 번은 HTTP GET 으로 웹 페이지를 요청해야 한다는 것이다. 이때 애플리케이션은 고유한 토큰을 생성한다. 이제부터 애플리케이션은 헤더에 이 고유한 값이 들어 있는 요청에 대해서만 변경 작업(`POST`, `DELETE`, `PUT` )을 수행한다. 애플리케이션은 토큰의 값을 안다는 것은 다른 시스템이 아닌 애플리케이션 자체가 변경 요청을 보낸 증거라고 본다. `POST`, `DELETE`, `PUT`  를 비롯한 **변경 호출을 포함하는 모든 페이지**는 응답을 통해 CSRF 토큰을 받고 변경 호출을 할 때 이 토큰을 이용해야 한다.

> CSRF 보호는 **브라우저**에서 실행되는 웹 앱에 이용되며, 앱의 표시된 컨텐츠를 로드하는 브라우저가 변경 작업을 수행할 수 있다고 예상될 때 필요하다.

## CSRF 해결책
CSRF 공격을 방어하기 위해 애플리케이션은 HTTP 요청이 애플리케이션의 사용자 인터페이스를 통해 정상적으로 생성되었는지 확인할 방법이 필요합니다. 가장 좋은 방법은 CSRF 토큰을 사용하는 것입니다. CSRF 토큰은 CSRF 공격을 방지하는 데 사용되는 안전한 무작위 토큰입니다. 이 토큰은 사용자 세션마다 고유해야 하며, 추측하기 어렵도록 충분히 큰 무작위 값이어야 합니다.

CSRF 토큰은 애플리케이션 서버에서 최종 사용자의 요청이 동일한 앱 UI에서 온 것인지 정당성을 검증하는 데 사용됩니다. CSRF 토큰이 일치하지 않으면 애플리케이션 서버는 해당 요청을 거부합니다.

